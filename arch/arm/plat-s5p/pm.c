/* linux/arch/arm/plat-s5p/pm.c
 *
 * Copyright (c) 2010 Samsung Electronics Co., Ltd.
 *		http://www.samsung.com
 *
 * S5P Power Manager (Suspend-To-RAM) support
 *
 * Based on arch/arm/plat-s3c24xx/pm.c
 * Copyright (c) 2004,2006 Simtec Electronics
 *	Ben Dooks <ben@simtec.co.uk>
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
*/
#include <linux/init.h>
#include <linux/suspend.h>
#include <linux/errno.h>
#include <linux/time.h>
#include <linux/interrupt.h>
#include <linux/irq.h>
#include <linux/crc32.h>
#include <linux/ioport.h>
#include <linux/delay.h>
#include <linux/serial_core.h>
#include <linux/io.h>
#include <linux/platform_device.h>

#include <asm/cacheflush.h>
#include <mach/hardware.h>

#include <plat/map-base.h>
#include <plat/regs-serial.h>
#include <plat/regs-timer.h>
#include <mach/regs-clock.h>
#include <plat/gpio-cfg.h>
#include <mach/regs-mem.h>
#include <mach/regs-irq.h>
#include <linux/gpio.h>
#include <mach/regs-gpio.h>
#include <mach/gpio-bank-eint.h>
#include <mach/gpio-bank-gpioint.h>
#include <mach/gpio-smdkc110.h>
#include <asm/mach/time.h>

#include <plat/pm.h>
#include <mach/irqs.h>

#define PFX "s5p pm: "

/* s3c_pm_configure_extint
 *
 * configure all external interrupt pins
*/

static struct sleep_save core_save[] = {
/* PLL Control */
	SAVE_ITEM(S5P_APLL_CON),
	SAVE_ITEM(S5P_MPLL_CON),
	SAVE_ITEM(S5P_EPLL_CON),
	SAVE_ITEM(S5P_VPLL_CON),
/* Clock source */
	SAVE_ITEM(S5P_CLK_SRC0),
	SAVE_ITEM(S5P_CLK_SRC1),
	SAVE_ITEM(S5P_CLK_SRC2),
	SAVE_ITEM(S5P_CLK_SRC3),
	SAVE_ITEM(S5P_CLK_SRC4),
	SAVE_ITEM(S5P_CLK_SRC5),
	SAVE_ITEM(S5P_CLK_SRC6),
/* Clock source Mask */
	SAVE_ITEM(S5P_CLK_SRC_MASK0),
	SAVE_ITEM(S5P_CLK_SRC_MASK1),
/* Clock Divider */
	SAVE_ITEM(S5P_CLK_DIV0),
	SAVE_ITEM(S5P_CLK_DIV1),
	SAVE_ITEM(S5P_CLK_DIV2),
	SAVE_ITEM(S5P_CLK_DIV3),
	SAVE_ITEM(S5P_CLK_DIV4),
	SAVE_ITEM(S5P_CLK_DIV5),
	SAVE_ITEM(S5P_CLK_DIV6),
	SAVE_ITEM(S5P_CLK_DIV7),
/* Clock Main Main Gate */
	SAVE_ITEM(S5P_CLKGATE_MAIN0),
	SAVE_ITEM(S5P_CLKGATE_MAIN1),
	SAVE_ITEM(S5P_CLKGATE_MAIN2),
/* Clock source Peri Gate */
	SAVE_ITEM(S5P_CLKGATE_PERI0),
	SAVE_ITEM(S5P_CLKGATE_PERI1),
/* Clock source SCLK Gate */
	SAVE_ITEM(S5P_CLKGATE_SCLK0),
	SAVE_ITEM(S5P_CLKGATE_SCLK1),
/* Clock IP Clock gate */
	SAVE_ITEM(S5P_CLKGATE_IP0),
	SAVE_ITEM(S5P_CLKGATE_IP1),
	SAVE_ITEM(S5P_CLKGATE_IP2),
	SAVE_ITEM(S5P_CLKGATE_IP3),
	SAVE_ITEM(S5P_CLKGATE_IP4),
/* Clock Blcok and Bus gate */
	SAVE_ITEM(S5P_CLKGATE_BLOCK),
	SAVE_ITEM(S5P_CLKGATE_IP5),
/* Clock ETC */
	SAVE_ITEM(S5P_CLK_OUT),
	SAVE_ITEM(S5P_MDNIE_SEL),
/* PWM Register */
	SAVE_ITEM(S3C2410_TCFG0),
	SAVE_ITEM(S3C2410_TCFG1),
	SAVE_ITEM(S3C64XX_TINT_CSTAT),
	SAVE_ITEM(S3C2410_TCON),
	SAVE_ITEM(S3C2410_TCNTB(0)),
	SAVE_ITEM(S3C2410_TCMPB(0)),
	SAVE_ITEM(S3C2410_TCNTO(0)),
};

static struct sleep_save sromc_save[] = {
	SAVE_ITEM(S5P_SROM_BW),
	SAVE_ITEM(S5P_SROM_BC0),
	SAVE_ITEM(S5P_SROM_BC1),
	SAVE_ITEM(S5P_SROM_BC2),
	SAVE_ITEM(S5P_SROM_BC3),
	SAVE_ITEM(S5P_SROM_BC4),
	SAVE_ITEM(S5P_SROM_BC5),
};
 
static struct sleep_save gpio_save_ext[] = {

	SAVE_ITEM(S5PV210_EINT0CON),
	SAVE_ITEM(S5PV210_EINT1CON),
	SAVE_ITEM(S5PV210_EINT2CON),
	SAVE_ITEM(S5PV210_EINT3CON),

	SAVE_ITEM(S5PV210_EINT0MASK),
	SAVE_ITEM(S5PV210_EINT1MASK),
	SAVE_ITEM(S5PV210_EINT2MASK),
	SAVE_ITEM(S5PV210_EINT3MASK),

	SAVE_ITEM(S5PV210_EINT0FLTCON0),
	SAVE_ITEM(S5PV210_EINT0FLTCON1),
	SAVE_ITEM(S5PV210_EINT1FLTCON0),
	SAVE_ITEM(S5PV210_EINT1FLTCON1),
	SAVE_ITEM(S5PV210_EINT2FLTCON0),
	SAVE_ITEM(S5PV210_EINT2FLTCON1),
	SAVE_ITEM(S5PV210_EINT3FLTCON0),
	SAVE_ITEM(S5PV210_EINT3FLTCON1),
};

/*gpio group interrupt*/
static struct sleep_save gpio_save_gpio_int[] = {

	SAVE_ITEM(S5PV210_GPA0INT_CON),
	SAVE_ITEM(S5PV210_GPA1INT_CON),
	SAVE_ITEM(S5PV210_GPBINT_CON),
	SAVE_ITEM(S5PV210_GPC0INT_CON),
	SAVE_ITEM(S5PV210_GPC1INT_CON),
	SAVE_ITEM(S5PV210_GPD0INT_CON),
	SAVE_ITEM(S5PV210_GPD1INT_CON),
	SAVE_ITEM(S5PV210_GPE0INT_CON),
	SAVE_ITEM(S5PV210_GPE1INT_CON),
	SAVE_ITEM(S5PV210_GPF0INT_CON),
	SAVE_ITEM(S5PV210_GPF1INT_CON),
	SAVE_ITEM(S5PV210_GPF2INT_CON),
	SAVE_ITEM(S5PV210_GPF3INT_CON),
	SAVE_ITEM(S5PV210_GPG0INT_CON),
	SAVE_ITEM(S5PV210_GPG1INT_CON),
	SAVE_ITEM(S5PV210_GPG2INT_CON),
	SAVE_ITEM(S5PV210_GPG3INT_CON),
	SAVE_ITEM(S5PV210_GPJ0INT_CON),
	SAVE_ITEM(S5PV210_GPJ1INT_CON),
	SAVE_ITEM(S5PV210_GPJ2INT_CON),
	SAVE_ITEM(S5PV210_GPJ3INT_CON),
	SAVE_ITEM(S5PV210_GPJ4INT_CON),


	SAVE_ITEM(S5PV210_GPA0INT_MASK),
	SAVE_ITEM(S5PV210_GPA1INT_MASK),
	SAVE_ITEM(S5PV210_GPBINT_MASK),
	SAVE_ITEM(S5PV210_GPC0INT_MASK),
	SAVE_ITEM(S5PV210_GPC1INT_MASK),
	SAVE_ITEM(S5PV210_GPD0INT_MASK),
	SAVE_ITEM(S5PV210_GPD1INT_MASK),
	SAVE_ITEM(S5PV210_GPE0INT_MASK),
	SAVE_ITEM(S5PV210_GPE1INT_MASK),
	SAVE_ITEM(S5PV210_GPF0INT_MASK),
	SAVE_ITEM(S5PV210_GPF1INT_MASK),
	SAVE_ITEM(S5PV210_GPF2INT_MASK),
	SAVE_ITEM(S5PV210_GPF3INT_MASK),
	SAVE_ITEM(S5PV210_GPG0INT_MASK),
	SAVE_ITEM(S5PV210_GPG1INT_MASK),
	SAVE_ITEM(S5PV210_GPG2INT_MASK),
	SAVE_ITEM(S5PV210_GPG3INT_MASK),
	SAVE_ITEM(S5PV210_GPJ0INT_MASK),
	SAVE_ITEM(S5PV210_GPJ1INT_MASK),
	SAVE_ITEM(S5PV210_GPJ2INT_MASK),
	SAVE_ITEM(S5PV210_GPJ3INT_MASK),
	SAVE_ITEM(S5PV210_GPJ4INT_MASK),

	SAVE_ITEM(S5PV210_GPA0INT_FLTCON0),
	SAVE_ITEM(S5PV210_GPA0INT_FLTCON1),
	SAVE_ITEM(S5PV210_GPA1INT_FLTCON0),
	SAVE_ITEM(S5PV210_GPA1INT_FLTCON1),
	SAVE_ITEM(S5PV210_GPBINT_FLTCON0),
	SAVE_ITEM(S5PV210_GPBINT_FLTCON1),
	SAVE_ITEM(S5PV210_GPC0INT_FLTCON0),
	SAVE_ITEM(S5PV210_GPC0INT_FLTCON1),
	SAVE_ITEM(S5PV210_GPC1INT_FLTCON0),
	SAVE_ITEM(S5PV210_GPC1INT_FLTCON1),
	SAVE_ITEM(S5PV210_GPD0INT_FLTCON0),
	SAVE_ITEM(S5PV210_GPD0INT_FLTCON1),
	SAVE_ITEM(S5PV210_GPD1INT_FLTCON0),
	SAVE_ITEM(S5PV210_GPD1INT_FLTCON1),
	SAVE_ITEM(S5PV210_GPE0INT_FLTCON0),
	SAVE_ITEM(S5PV210_GPE0INT_FLTCON1),
	SAVE_ITEM(S5PV210_GPE1INT_FLTCON0),
	SAVE_ITEM(S5PV210_GPE1INT_FLTCON1),
	SAVE_ITEM(S5PV210_GPF0INT_FLTCON0),
	SAVE_ITEM(S5PV210_GPF0INT_FLTCON1),
	SAVE_ITEM(S5PV210_GPF1INT_FLTCON0),
	SAVE_ITEM(S5PV210_GPF1INT_FLTCON1),
	SAVE_ITEM(S5PV210_GPF2INT_FLTCON0),
	SAVE_ITEM(S5PV210_GPF2INT_FLTCON1),
	SAVE_ITEM(S5PV210_GPF3INT_FLTCON0),
	SAVE_ITEM(S5PV210_GPF3INT_FLTCON1),
	SAVE_ITEM(S5PV210_GPG0INT_FLTCON0),
	SAVE_ITEM(S5PV210_GPG0INT_FLTCON1),
	SAVE_ITEM(S5PV210_GPG1INT_FLTCON0),
	SAVE_ITEM(S5PV210_GPG1INT_FLTCON1),
	SAVE_ITEM(S5PV210_GPG2INT_FLTCON0),
	SAVE_ITEM(S5PV210_GPG2INT_FLTCON1),
	SAVE_ITEM(S5PV210_GPG3INT_FLTCON0),
	SAVE_ITEM(S5PV210_GPG3INT_FLTCON1),
	SAVE_ITEM(S5PV210_GPJ0INT_FLTCON0),
	SAVE_ITEM(S5PV210_GPJ0INT_FLTCON1),
	SAVE_ITEM(S5PV210_GPJ1INT_FLTCON0),
	SAVE_ITEM(S5PV210_GPJ1INT_FLTCON1),
	SAVE_ITEM(S5PV210_GPJ2INT_FLTCON0),
	SAVE_ITEM(S5PV210_GPJ2INT_FLTCON1),
	SAVE_ITEM(S5PV210_GPJ3INT_FLTCON0),
	SAVE_ITEM(S5PV210_GPJ3INT_FLTCON1),
	SAVE_ITEM(S5PV210_GPJ4INT_FLTCON0),
	SAVE_ITEM(S5PV210_GPJ4INT_FLTCON1),

};

/* this lot should be really saved by the IRQ code */
/* VICXADDRESSXX initilaization to be needed */
static struct sleep_save irq_save[] = {
	SAVE_ITEM(S5P_VIC0REG(VIC_INT_SELECT)),
	SAVE_ITEM(S5P_VIC1REG(VIC_INT_SELECT)),
	SAVE_ITEM(S5P_VIC2REG(VIC_INT_SELECT)),
	SAVE_ITEM(S5P_VIC3REG(VIC_INT_SELECT)),
	SAVE_ITEM(S5P_VIC0REG(VIC_INT_ENABLE)),
	SAVE_ITEM(S5P_VIC1REG(VIC_INT_ENABLE)),
	SAVE_ITEM(S5P_VIC2REG(VIC_INT_ENABLE)),
	SAVE_ITEM(S5P_VIC3REG(VIC_INT_ENABLE)),
	SAVE_ITEM(S5P_VIC0REG(VIC_INT_SOFT)),
	SAVE_ITEM(S5P_VIC1REG(VIC_INT_SOFT)),
	SAVE_ITEM(S5P_VIC2REG(VIC_INT_SOFT)),
	SAVE_ITEM(S5P_VIC3REG(VIC_INT_SOFT)),
};

static struct sleep_save gpio_save_gpio[] = {
	SAVE_ITEM(S5PV210_GPA0CON),
	SAVE_ITEM(S5PV210_GPA0DAT),
	SAVE_ITEM(S5PV210_GPA0PUD),
	SAVE_ITEM(S5PV210_GPA0DRV),
	SAVE_ITEM(S5PV210_GPA0CONPDN),
	SAVE_ITEM(S5PV210_GPA0PUDPDN),

	SAVE_ITEM(S5PV210_GPA1CON),
	SAVE_ITEM(S5PV210_GPA1DAT),
	SAVE_ITEM(S5PV210_GPA1PUD),
	SAVE_ITEM(S5PV210_GPA1DRV),
	SAVE_ITEM(S5PV210_GPA1CONPDN),
	SAVE_ITEM(S5PV210_GPA1PUDPDN),

	SAVE_ITEM(S5PV210_GPBCON),
	SAVE_ITEM(S5PV210_GPBDAT),
	SAVE_ITEM(S5PV210_GPBPUD),
	SAVE_ITEM(S5PV210_GPBDRV),
	SAVE_ITEM(S5PV210_GPBCONPDN),
	SAVE_ITEM(S5PV210_GPBPUDPDN),

	SAVE_ITEM(S5PV210_GPC0CON),
	SAVE_ITEM(S5PV210_GPC0DAT),
	SAVE_ITEM(S5PV210_GPC0PUD),
	SAVE_ITEM(S5PV210_GPC0DRV),
	SAVE_ITEM(S5PV210_GPC0CONPDN),
	SAVE_ITEM(S5PV210_GPC0PUDPDN),

	SAVE_ITEM(S5PV210_GPC1CON),
	SAVE_ITEM(S5PV210_GPC1DAT),
	SAVE_ITEM(S5PV210_GPC1PUD),
	SAVE_ITEM(S5PV210_GPC1DRV),
	SAVE_ITEM(S5PV210_GPC1CONPDN),
	SAVE_ITEM(S5PV210_GPC1PUDPDN),

	SAVE_ITEM(S5PV210_GPD0CON),
	SAVE_ITEM(S5PV210_GPD0DAT),
	SAVE_ITEM(S5PV210_GPD0PUD),
	SAVE_ITEM(S5PV210_GPD0DRV),
	SAVE_ITEM(S5PV210_GPD0CONPDN),
	SAVE_ITEM(S5PV210_GPD0PUDPDN),

	SAVE_ITEM(S5PV210_GPD1CON),
	SAVE_ITEM(S5PV210_GPD1DAT),
	SAVE_ITEM(S5PV210_GPD1PUD),
	SAVE_ITEM(S5PV210_GPD1DRV),
	SAVE_ITEM(S5PV210_GPD1CONPDN),
	SAVE_ITEM(S5PV210_GPD1PUDPDN),

	SAVE_ITEM(S5PV210_GPE0CON),
	SAVE_ITEM(S5PV210_GPE0DAT),
	SAVE_ITEM(S5PV210_GPE0PUD),
	SAVE_ITEM(S5PV210_GPE0DRV),
	SAVE_ITEM(S5PV210_GPE0CONPDN),
	SAVE_ITEM(S5PV210_GPE0PUDPDN),

	SAVE_ITEM(S5PV210_GPE1CON),
	SAVE_ITEM(S5PV210_GPE1DAT),
	SAVE_ITEM(S5PV210_GPE1PUD),
	SAVE_ITEM(S5PV210_GPE1DRV),
	SAVE_ITEM(S5PV210_GPE1CONPDN),
	SAVE_ITEM(S5PV210_GPE1PUDPDN),

	SAVE_ITEM(S5PV210_GPF0CON),
	SAVE_ITEM(S5PV210_GPF0DAT),
	SAVE_ITEM(S5PV210_GPF0PUD),
	SAVE_ITEM(S5PV210_GPF0DRV),
	SAVE_ITEM(S5PV210_GPF0CONPDN),
	SAVE_ITEM(S5PV210_GPF0PUDPDN),

	SAVE_ITEM(S5PV210_GPF1CON),
	SAVE_ITEM(S5PV210_GPF1DAT),
	SAVE_ITEM(S5PV210_GPF1PUD),
	SAVE_ITEM(S5PV210_GPF1DRV),
	SAVE_ITEM(S5PV210_GPF1CONPDN),
	SAVE_ITEM(S5PV210_GPF1PUDPDN),

	SAVE_ITEM(S5PV210_GPF2CON),
	SAVE_ITEM(S5PV210_GPF2DAT),
	SAVE_ITEM(S5PV210_GPF2PUD),
	SAVE_ITEM(S5PV210_GPF2DRV),
	SAVE_ITEM(S5PV210_GPF2CONPDN),
	SAVE_ITEM(S5PV210_GPF2PUDPDN),

	SAVE_ITEM(S5PV210_GPF3CON),
	SAVE_ITEM(S5PV210_GPF3DAT),
	SAVE_ITEM(S5PV210_GPF3PUD),
	SAVE_ITEM(S5PV210_GPF3DRV),
	SAVE_ITEM(S5PV210_GPF3CONPDN),
	SAVE_ITEM(S5PV210_GPF3PUDPDN),

	SAVE_ITEM(S5PV210_GPG0CON),
	SAVE_ITEM(S5PV210_GPG0DAT),
	SAVE_ITEM(S5PV210_GPG0PUD),
	SAVE_ITEM(S5PV210_GPG0DRV),
	SAVE_ITEM(S5PV210_GPG0CONPDN),
	SAVE_ITEM(S5PV210_GPG0PUDPDN),

	SAVE_ITEM(S5PV210_GPG1CON),
	SAVE_ITEM(S5PV210_GPG1DAT),
	SAVE_ITEM(S5PV210_GPG1PUD),
	SAVE_ITEM(S5PV210_GPG1DRV),
	SAVE_ITEM(S5PV210_GPG1CONPDN),
	SAVE_ITEM(S5PV210_GPG1PUDPDN),

	SAVE_ITEM(S5PV210_GPG2CON),
	SAVE_ITEM(S5PV210_GPG2DAT),
	SAVE_ITEM(S5PV210_GPG2PUD),
	SAVE_ITEM(S5PV210_GPG2DRV),
	SAVE_ITEM(S5PV210_GPG2CONPDN),
	SAVE_ITEM(S5PV210_GPG2PUDPDN),

	SAVE_ITEM(S5PV210_GPG3CON),
	SAVE_ITEM(S5PV210_GPG3DAT),
	SAVE_ITEM(S5PV210_GPG3PUD),
	SAVE_ITEM(S5PV210_GPG3DRV),
	SAVE_ITEM(S5PV210_GPG3CONPDN),
	SAVE_ITEM(S5PV210_GPG3PUDPDN),

	SAVE_ITEM(S5PV210_GPH0CON),
	SAVE_ITEM(S5PV210_GPH0DAT),
	SAVE_ITEM(S5PV210_GPH0PUD),
	SAVE_ITEM(S5PV210_GPH0DRV),

	SAVE_ITEM(S5PV210_GPH1CON),
	SAVE_ITEM(S5PV210_GPH1DAT),
	SAVE_ITEM(S5PV210_GPH1PUD),
	SAVE_ITEM(S5PV210_GPH1DRV),

	SAVE_ITEM(S5PV210_GPH2CON),
	SAVE_ITEM(S5PV210_GPH2DAT),
	SAVE_ITEM(S5PV210_GPH2PUD),
	SAVE_ITEM(S5PV210_GPH2DRV),

	SAVE_ITEM(S5PV210_GPH3CON),
	SAVE_ITEM(S5PV210_GPH3DAT),
	SAVE_ITEM(S5PV210_GPH3PUD),
	SAVE_ITEM(S5PV210_GPH3DRV),

	SAVE_ITEM(S5PV210_GPICON),
	SAVE_ITEM(S5PV210_GPIDAT),
	SAVE_ITEM(S5PV210_GPIPUD),
	SAVE_ITEM(S5PV210_GPIDRV),
	SAVE_ITEM(S5PV210_GPICONPDN),
	SAVE_ITEM(S5PV210_GPIPUDPDN),

	SAVE_ITEM(S5PV210_GPJ0CON),
	SAVE_ITEM(S5PV210_GPJ0DAT),
	SAVE_ITEM(S5PV210_GPJ0PUD),
	SAVE_ITEM(S5PV210_GPJ0DRV),
	SAVE_ITEM(S5PV210_GPJ0CONPDN),
	SAVE_ITEM(S5PV210_GPJ0PUDPDN),

	SAVE_ITEM(S5PV210_GPJ1CON),
	SAVE_ITEM(S5PV210_GPJ1DAT),
	SAVE_ITEM(S5PV210_GPJ1PUD),
	SAVE_ITEM(S5PV210_GPJ1DRV),
	SAVE_ITEM(S5PV210_GPJ1CONPDN),
	SAVE_ITEM(S5PV210_GPJ1PUDPDN),

	SAVE_ITEM(S5PV210_GPJ2CON),
	SAVE_ITEM(S5PV210_GPJ2DAT),
	SAVE_ITEM(S5PV210_GPJ2PUD),
	SAVE_ITEM(S5PV210_GPJ2DRV),
	SAVE_ITEM(S5PV210_GPJ2CONPDN),
	SAVE_ITEM(S5PV210_GPJ2PUDPDN),

	SAVE_ITEM(S5PV210_GPJ3CON),
	SAVE_ITEM(S5PV210_GPJ3DAT),
	SAVE_ITEM(S5PV210_GPJ3PUD),
	SAVE_ITEM(S5PV210_GPJ3DRV),
	SAVE_ITEM(S5PV210_GPJ3CONPDN),
	SAVE_ITEM(S5PV210_GPJ3PUDPDN),

	SAVE_ITEM(S5PV210_GPJ4CON),
	SAVE_ITEM(S5PV210_GPJ4DAT),
	SAVE_ITEM(S5PV210_GPJ4PUD),
	SAVE_ITEM(S5PV210_GPJ4DRV),
	SAVE_ITEM(S5PV210_GPJ4CONPDN),
	SAVE_ITEM(S5PV210_GPJ4PUDPDN),
};

//////////////////////////////////////////////////////////////////////////////////////////////////////

#define eint_offset(irq)                (irq)
#define eint_irq_to_bit(irq)            (1 << (eint_offset(irq) & 0x7))
#define eint_conf_reg(irq)              ((eint_offset(irq)) >> 3)
#define eint_filt_reg(irq)              ((eint_offset(irq)) >> 2)
#define eint_mask_reg(irq)              ((eint_offset(irq)) >> 3)
#define eint_pend_reg(irq)              ((eint_offset(irq)) >> 3)

// intr_mode 0x2=>falling edge, 0x3=>rising dege, 0x4=>Both edge
static void s3c_pm_set_eint(unsigned int pin, unsigned int irq, unsigned int intr_mode)
{
	int shift;
	unsigned int ctrl, mask;

  shift = (irq & 0x7) * 4;

  s3c_gpio_cfgpin(pin, S3C_GPIO_SFN(0xF));
	s3c_gpio_setpull(pin, S3C_GPIO_PULL_NONE);

	/*Set irq type*/
	mask = 0x7 << shift;
	ctrl = readl(S5PV210_EINTCON(eint_conf_reg(irq)));
	ctrl &= ~mask;
	ctrl |= intr_mode << shift;

	writel(ctrl, S5PV210_EINTCON(eint_conf_reg(irq)));
	/*clear mask*/
	mask = readl(S5PV210_EINTMASK(eint_mask_reg(irq)));
	mask &= ~(eint_irq_to_bit(irq));
	writel(mask, S5PV210_EINTMASK(eint_mask_reg(irq)));

	/*clear pending*/
	mask = readl(S5PV210_EINTPEND(eint_pend_reg(irq)));
	mask &= (eint_irq_to_bit(irq));
	writel(mask, S5PV210_EINTPEND(eint_pend_reg(irq)));
	
	/*Enable wake up mask*/
	s3c_irqwake_eintmask &= ~(1 << irq);

//	printk("S5PV210_EINTCON = 0x%x\n",readl(S5PV210_EINTCON(eint_conf_reg(irq))));
//	printk("S5PV210_EINTMASK = 0x%x\n",readl(S5PV210_EINTMASK(eint_mask_reg(irq))));
//	printk("S5PV210_EINTPEND = 0x%x\n",readl(S5PV210_EINTPEND(eint_pend_reg(irq))));

	return;
}

//static void s3c_pm_clear_eint(unsigned int pin)
//{
//	unsigned int irq;
//	unsigned int mask;
//	irq = gpio_to_irq(pin);
//	/*clear pending*/
//	mask = readl(S5PV210_EINTPEND(eint_pend_reg(irq)));
//	mask &= (eint_irq_to_bit(irq));
//	writel(mask, S5PV210_EINTPEND(eint_pend_reg(irq)));
//}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void s3c_pm_configure_extint(void)
{
#if defined(GPIO_KEY_POWER)   //Power key
	s3c_pm_set_eint(GPIO_KEY_POWER, GPIO_KEY_POWER_EINT, S5PV210_EINT_INT_FALLING);
#endif

//#if defined(GPIO_KEY_POWER)   //volume_up key
//	s3c_pm_set_eint(GPIO_KEY_VOLUME_UP, GPIO_KEY_VUP_EINT, S5PV210_EINT_INT_FALLING);
//#endif
//
//#if defined(GPIO_KEY_POWER)   //volume_down key
//	s3c_pm_set_eint(GPIO_KEY_VOLUME_DOWN, GPIO_KEY_VDOWN_EINT, S5PV210_EINT_INT_FALLING);
//#endif

#if defined(CONFIG_S5PV210_DEVBOARD)   //HOME key
	s3c_pm_set_eint(GPIO_KEY_HOME, GPIO_KEY_HOME_EINT, S5PV210_EINT_INT_FALLING);
#endif
}

void s3c_pm_restore_core(void)
{
	s3c_pm_do_restore_core(core_save, ARRAY_SIZE(core_save));
	s3c_pm_do_restore(sromc_save, ARRAY_SIZE(sromc_save));
	s3c_pm_do_restore(gpio_save_gpio, ARRAY_SIZE(gpio_save_gpio));
	s3c_pm_do_restore(gpio_save_ext, ARRAY_SIZE(gpio_save_ext));
	s3c_pm_do_restore(gpio_save_gpio_int, ARRAY_SIZE(gpio_save_gpio_int));
	s3c_pm_do_restore(irq_save, ARRAY_SIZE(irq_save));
}

void s3c_pm_save_core(void)
{
	s3c_pm_do_save(sromc_save, ARRAY_SIZE(sromc_save));
	s3c_pm_do_save(core_save, ARRAY_SIZE(core_save));
	s3c_pm_do_save(gpio_save_gpio, ARRAY_SIZE(gpio_save_gpio));
	s3c_pm_do_save(gpio_save_ext, ARRAY_SIZE(gpio_save_ext));
	s3c_pm_do_save(gpio_save_gpio_int, ARRAY_SIZE(gpio_save_gpio_int));
	s3c_pm_do_save(irq_save, ARRAY_SIZE(irq_save));
}

